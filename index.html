<!-- 

index.html

This is the  main index.html page for the web app.

It was inspired by the emoji scavenger hunt google project and teachable machine(see CREDITS below).
The emoji savenger hunt however was written in typscript. I modified the code so it
could run with raw/vanilla javascript. (Thank you  to the dev team of the
emoji scavenger hunt for ansering all my questions regarding their app). Instead of
creating a UX/UI for a game to detect emojis(like in the original), the current frontEnd 
is used to scan images and then takes you to a google image search to cross reference the image
found. 

Updated as of 11/27/2019:
using the teachable machine API
https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
Will now use tmImage module to handle the video capture and model predict functions

Updated as of April 2022:
I've also taken recent inspiration from the teachable machine (see links  below)
which allows anyone to train their own AI models in the cloud. The updated version 
uses the teachable machines libarary to more easily load AI/ML models using
tensorflow.js.


CREDITS:
inspired by code from 
https://github.com/google/emoji-scavenger-hunt under the APACHE 2.0 License
https://github.com/googlecreativelab/teachable-machine-v1 under the APACHE 2.0 License



AUTHOR OF CURRENT CODE: Erwin John T. Carpio

 Copyright 2022 ERWIN JOHN T. CARPIO

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.


-->

<!-- TODO: OUTLINE for project RadLens_ortho_cloud
    --DONE  KEPT AT RADLENS by RADEDJE NAME
    --CONVERT modelselector to form =DONE
    -- look at $modelSelector.addEventListener in radedje-AI radhorizon (successfully converted to form)
    --merge animations of  radedje-AI radhorizono (so far animations work but
    had to do event.preventDefault(); upon form submission => FIXED => DONE
    --currently submitting the old model breaks the app (correction, it was Just the wrong URL.... it works)
    --try fixing the info cards. => DONE (decided to not use my person virtual DOM using JSON and wrote native static html)
    --removed projectJson.js from script tag.
    --protect form by converting to string. =>DONE
    --parse string to google image search string using: {<NAME>,search terms} http://www.google.com/images?q=your+search+terms =>DONE

     
    
    TODO: CLEAN UP UX/UI and CODE
    --clean up the code
    --LINK TO A TUTORIAL VID
    --Prepare for teach about AI model performance
    --CLEAN UP CODE and refer to teachable machine and emoji scavenger hunt.... 
-->



<!doctype html>
<html lang="en">

<head>



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>RadLens AI by RadEdje</title>
    <link rel="stylesheet" href="./public/css/styles.css">

    <!-- FONTS -->
    <link
        href="https://fonts.googleapis.com/css?family=Amethysta|Rambla|Dancing+Script|Gloria+Hallelujah|Indie+Flower|Lobster|Pacifico|Orbitron|Berkshire+Swash|Macondo+Swash+Caps|Cookie"
        rel="stylesheet">

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
        integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">


    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script> -->

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js" type="text/javascript"></script>

    <!-- <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script> -->

</head>

<body>


    <!-- facebook sdk start-->
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v5.0">
    </script>

    <!-- facebook sdk end -->

    <a id="headerLink"></a>
    <div id="header" class="header">

        <div class="headerLeft" id="headerLeft">
            <p id="header__burger" class="header__burger">
                <i class="fas fa-bars"></i>
            </p>
            <p>RadLens-AI by RadEdje</p>
        </div>

        <div class="headerRight" id="headerRight">
            <div class="headerRight_options">
                <i id="shareIcon" class="fas fa-share"></i>
                <div id="share__btns" class="share__btns share__btns--hidden">



                    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button"
                        data-size="large"
                        data-text="Check it out. #Tensorflow #Tensorflow.js #RadLens-AI #teachablemachine "
                        data-show-count="false">Tweet</a>
                    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>



                    <div class="fb-share-button" data-href="https://radhorizon.com/RadLens%20AI%20Foot%20Ossicles/"
                        data-layout="button" data-size="large"><a target="_blank"
                            href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fradhorizon.com%2FRadLens%2520AI%2520Foot%2520Ossicles%2F&amp;src=sdkpreparse"
                            class="fb-xfbml-parse-ignore">Share</a>
                    </div>


                </div>
            </div>
        </div>

    </div>


    <div id="dimmer" class="dimmer dimmer--hide"></div>

    <div id="menu" class="menu menu--hide">
        <div id="menu_exit" class="menu_exit">
            <i class="fas fa-times"></i>
        </div>

        <div>
            <h1>User Guide</h1>
        </div>

        <ul>
            <li>
                <h2>About the WebApp</h2>

                <p>This is a web app I'm developing that uses AI/Machine learning in the browser that tries to predict
                    or infer
                    what it sees in an image using your computer's, tablet's or phone's camera. It uses tensorflow.js
                    and
                    runs completely on your local machine and in the browser. No image data is uploaded to any server
                    to protect privacy.</p>

                <p> This web app runs an AI/ML algorithm completely in the browser and can use graphics acceleration for
                    faster inference and prediction.</p>

                <p> It uses the camera (On phone or desktop) to scan images and tries to recognize images
                    (not certified for professional or medical use and is simply a proof of concept). No images or video
                    are
                    uploaded to any cloud server. All computations are processed directly on your machine.
                </p>

                <p>
                    If you have your own pretrained custom model using <a
                        href="https://teachablemachine.withgoogle.com/"
                        style="font-weight: bold; font-size:larger">Teachable Machine</a>,
                    you can copy and then paste the link to your model in the form box at the lower left hand corner of
                    the app.
                </p>

                <p>Currently known to run on: The latest firefox, opera and chrome on desktop/laptop, Samsung galaxy S8,
                    Mi6, OnePlus5T (on android 8.0 oreo), iphoneX, iphoneSE, iphoneC (running at least safari 11).
                    Hardware
                    limitations may limit the speed of the prediction or drain phone batteries quickly as AI/ML may
                    prove demanding
                    on certain types of hardware. The current version's initial loading time can reach less than 5-15
                    seconds
                    depending on the internet speed (this is even faster than the older loading times of 10-20 seconds)
                    as
                    the AI/ML model is deployed. Subsequent reloads will be faster as the model is cached (unless the
                    browser is closed and restarted).
                </p>
            </li>
            <li>
                <h2>Camera Scanner</h2>
                <p>Press the round button on the lower right to start scanning.</p>
                <p>Focus the camera on an image.</p>
                <p>Real time predictions and their respective probabilites are on the upper left.</p>

                <p>Final prediction will be at the bottom bar revealing a link to a google image search</p>
                <p>To hide real time predictions, differentials and their probabilities...press the button below
                </p>

                <button id="debug" class="debug">Hide/Show differentials and probabilities (the top left box)</button>

            </li>

            <li>
                <h2>Current work in progress by:</h2>
                <p>Dr. Erwin John T. Carpio (Radiologist, FrontEnd Web Developer, AI Enthusiast).
                </p>
            </li>

            <li>
                <p>I tried my hand at an AI/ML project so that I might hopefully encourage my fellow radiologists
                    in my country or anywhere in the world to more actively participate in the growth and development
                    of AI/ML for radiology. I hope to prove to them that the technology is not beyond their reach
                    especially with amazing libraries like tensorflow which have made it easier and more approachable
                    for professionals like myself to explore the amazing world and possible applications of AI/ML in
                    my domain of expertise.
                </p>
            </li>

            <li>
                <h2>After Thoughts</h2>
                <p>Would a DICOM scanner be intersting?</p>
                <p>This is currently a "proof of concept" (powered by tensorflow and tensorflow.js) to help inform and
                    spread the word
                    on the possibilities of AI/ML applications in medicine and radiology. If you have suggestions or
                    want to
                    collaborate on a project we can always discuss. You can find me on:
                </p>
                <div id="socialIcons" class="socialIcons">
                    <a href="https://www.facebook.com/erwinjohn.carpio.7">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://github.com/RadEdje">
                        <i class="fab fa-github-square"></i>
                    </a>
                    <a href="https://twitter.com/CarpioEjt">
                        <i class="fab fa-twitter-square"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/erwin-john-t-carpio-md/">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </div>

            </li>
            <li>
                <h2>Some Resources:</h2>
                <p>
                    <a href="https://www.tensorflow.org/">Tensorflow (python)</a>
                </p>
                <p>
                    <a href="https://js.tensorflow.org/">Tensorflow.js</a>
                </p>
                <p>
                    <a href="https://keras.io/">keras.io</a>
                </p>
                <p>
                    <a href="https://teachablemachine.withgoogle.com/">Teachable Machine</a>
                </p>
            </li>
        </ul>
    </div>

    <div id="splash" class="splash splash--noClick">
        <div id="welcome" class="welcome">
            <h1>RadLens-AI by RadEdje...</h1>

            <div class="subtitle">

                <p>A web app for deploying AI computer vision models with little or NO CODE. <br>

                </p>

            </div>


            <div id="subtitle0" class="subtitle">
                <p id="loading0" class="loading">
                    Loading AI model........
                    <i class="fas fa-spinner fa-1x fa-spin"></i>
                </p>
            </div>


            <p>
                The web app acts as a <i><b>Customizable Reverse Image Search Engine (CRISE)</b></i>. It will try to
                classify what
                it sees using your computer, tablet, or phone's web cam and then produce a hyperlink
                at the bottom that will take you to a google image search page showing you other images
                that may match what the camera is currently looking at. Apps with similar reverse image search
                functionality already exist such as
                <a href="https://lens.google/" style="font-weight: bold; font-size:larger"> google lens</a> but this web
                app allows the user to train his/her/their own custom AI/ML
                model on <a href="https://teachablemachine.withgoogle.com/"
                    style="font-weight: bold; font-size:larger">Teachable Machine</a>
                to create custom reverse image search engines (personal C-RISE) for specific use cases.
                (Please scroll down and read to accept the terms of use and begin.)
            </p>
            <p>Initial load may takes 5-10 seconds (on slow connections). Press the
                lower right button to start scanning. Focus camera on an image you
                want to analyze. Real time predictions are on the upper left. Final prediction
                will be at the bottom (as a hyperlink to google image search).
            </p>

            <p>The information provided by RadLens-AI (hereinafter “we,” “us” or “our”)
                on radhorizon.com (the “Site”) is for general informational and educational
                purposes only and is not a substitute for professional or expert medical advice.
                RadLense-AI is currently not FDA approved and not a medical grade device.
            </p>

            <p>
                Under no circumstance shall we have any liability to you for any loss or damage
                of any kind incurred by using the site or relying on any information provided on
                the site. Your use of the site and your reliance on any information on the site
                is solely at your own risk.
            </p>

            <p>
                The Site may contain (or you may be sent through the Site links to other websites
                or content belonging to or originating from third parties or links to websites
                and features. Such external links are not investigated, monitored, or checked for
                accuracy, adequacy, validity, reliability, availability or completeness by us.
            </p>



            <p>
                At the time of this writing, the web app has the ability to accept a URL link to
                pre-trained AI models hosted at
                <a href="https://teachablemachine.withgoogle.com/" style="font-weight: bold; font-size:larger">Teachable
                    Machine</a>.
                You can place the URL link to your custom model hosted on teachable machine in the form input box at
                lower left hand corner of the initial screen and then click submit.
                From here the app will reload and then function running the new AI model to distinguish classes that the
                new AI/ML model is trained on. It is advised that the user/users of the RadLens-AI webapp/webpage
                copy/paste URL links only for AI/ML model's from trusted sources (either AI/ML models
                personally trained by him/her/them or models trained by people he/she/they trust).
                Under no circumstances will the RadLens-AI web app ever ask for or require personal or private
                information to be placed
                in the input form to run.
            </p>

            <p>
                BY CLICKING “ACCEPT” OR ACCESSING THE SITE/WEBPAGE AND/OR USING THE
                INFORMATION/ SERVICE, YOU ACKNOWLEDGE THAT YOU HAVE READ, UNDERSTOOD, AND
                AGREE TO BE BOUND BY THE TERMS OF USE. IF YOU CHOSE NOT TO BE BOUND BY THESE
                TERMS OF USE, YOU MAY NOT ACCESS OR USE THE SITE, INFORMATION OR SERVICES.
            </p>

            <div id="subtitle" class="subtitle">
                <p id="loading" class="loading">
                    Loading AI model........
                    <i class="fas fa-spinner fa-1x fa-spin"></i>
                </p>
            </div>






        </div>

    </div>

    <div id="ddx" class="ddx">
        <p id="ddxTitle" class="ddxTitle">Differentials:</p>
        <p id="ddxScore" class="ddxScore"></p>
        <div id="ddxBtn" class="ddxBtn">^</div>
    </div>



    <div id="errors" class="errors"></div>

    <div id="main" class="main main--freeze">
        <a id="form_modelSelectorLink"></a>
        <form action="" id="form_modelSelector" class="form_modelSelector">


            <div class="form_modelSelector__elements" title="paste URL to your model here">
                <label for="mpr">AI model</label>
                <input type="text" placeholder="./my_model/" required name="mpr" id="mpr">
            </div>

            <div class="form_modelSelector__elements"
                title="defines the threshold or degree of sureness for the AI to stop scanning">
                <label for="sensitivityInput">Threshold</label>
                <input type="text" placeholder="none" required name="sensitivityInput" id="sensitivityInput">
            </div>


            <input type="submit" value="Submit" id="modelUrl">
        </form>



        <div id="webcamContainer" class="webcamContainer"></div>




        <div id="prediction" class="prediction">
            <div id="final_ddx" class="final_ddx">
                <p>Please tap the camera button.</p>
            </div>
        </div>




        <div id="trainingSection" class="trainingSection">

            <h1>Make your own "Teachable Machine" using Transfer Learning with MobileNet v3 in TensorFlow.js using saved
                graph model from TFHub.</h1>



            <!-- THIS WILL EVENTUALLY REPLACE THE STATIC <video id="webcam" autoplay> as my js library class will create this. -->
            <!-- <div id="webcamContainer-Trainer" class="webcamContainer">
                <p style="color:white; 
                        position: absolute;
                        z-index: 10;
                        border-style: solid;
                        border-color: whit">
                    Training mode
                </p>
                <div id="webcamContainerTrainer" class="webcamContainer">
                </div>
            </div> -->


            <video id="webcam" autoplay></video>


            <div id="trainingSectionBottomBar" class="trainingSectionBottomBar">

                <p id="status">Awaiting TF.js model for custom training to load</p>


                <button id="enableCam">Enable Webcam</button>
                <!-- <button class="dataCollector" data-1hot="0" data-name="Class 1">Gather Class 1 Data</button>
                <button class="dataCollector" data-1hot="1" data-name="Class 2">Gather Class 2 Data</button> -->



                <form id="formButtonDataList" action="">
                    <div id="buttonsDataList" class="buttonsDataList">
                        <div class="input_btn_unit">

                            <label for="input1">Class Name 1</label>
                            <input id="input1" class = "input_class_name" type="text" value = "Class 1" placeholder="edit name here">
                            <button id="btn1" data-onehot="0" data-name="Class 1" class="dataCollector">Gather Class 1 Data</button>

                        </div>


                        <div class="input_btn_unit">

                            <label for="input2">Class Name 2</label>
                            <input id="input2" class = "input_class_name" type="text" value = "Class 2" placeholder="edit name here">                        
                            <button id="btn2" data-onehot="1" data-name="Class 2" class="dataCollector">Gather Class 2 Data</button>

                        </div>
                      
                        

                    </div>
                </form>

                <!-- <div id="buttonsDataList" class="buttonsDataList">
                    <button  data-onehot="0" data-name="Class 1" class="dataCollector" >Gather Class 1 Data</button>
                    <button  data-onehot="1" data-name="Class 2" class="dataCollector" >Gather Class 2 Data</button>
                </div> -->

                <button id="addDataCollectorbtn" class="addDataCollectorbtn">Add a class</button>

                <button id="train">Train &amp; Predict!</button>
                <button id="save" class="save">SAVE and Export</button>
                <button id="reset">Reset</button>




            </div>


            <ol>
                <li>First enable webcam and allow access when asked.</li>
                <li>Now find an object, point cam at it, click and hold gather class 1 data button to gather at least 30
                    samples.</li>
                <li>Repeat for class 2 with a different object of interest. Get similar number of samples.</li>
                <li>Click train and predict and wait while the model is trained live in your browser. No data is sent to
                    server.</li>
                <li>Once trained you will see live predictions appear above the video for what it thinks it sees.</li>
            </ol>



        </div>



        <div class="info-section">


            <div id="" class="card card--wide">
                <div class="card__title">
                    <h1>Google Image Search</h1>
                </div>

                <div class="card__body">
                    <p>You can proceed to a google image search page generated from the AI/ML
                        model's prediction by clicking the link below. If a prediction has not been made
                        by the AI/ML model, the link will take you back to the top of the page.
                        (See the next card or "Quick Facts" for further instructions on how to use the web app.).
                    </p>
                </div>

                <div id="card__action" class="card__action">
                    <p><a id="card_imageSearch_link" href="#headerLink">Take me to google image search.</a></p>
                </div>
            </div>

            <div id="card_basicInfo" class="card card--wide">
                <div class="card__title">
                    <h1>Quick Facts</h1>
                </div>

                <div id="card_basicInfo_body" class="card__body">
                    <p>Quick Instructions:</p>
                    <p>Scroll all the way to the top to reveal the
                        Camera Icon at the right lower corner.

                    </p>

                    <a href="#form_modelSelectorLink"> <img style="height:5rem" src="./img/camera_icon.jpg"
                            alt="click on me to take you to the form box"> </a>

                    <p>
                        Click the camera icon and focus your camera on a
                        scene or image you want to analyze. Try to focus on a specific part and see how the AI
                        algorithm
                        tries to guess what it is.</p> </br>

                    <p>If you have your own custom model hosted on teachable machine's servers, you can copy and paste
                        the link to your model in the form box (see picture below) and replace the <b>./my_model/.</b>
                        Clicking on the image will also take you to the location of the form box. </p> </br>

                    <a href="#form_modelSelectorLink"> <img src="./img/my_model.jpg"
                            alt="click on me to take you to the form box" class="imageOfModelSelector"> </a>

                    <p> The box to the right of the <b>./my_model/</b>
                        represent the threshold value used by the AI model. Think of "threshold" as
                        the level of "sureness" an AI has regarding its prediction.

                        This is set to "any" by default meaning the AI will keep guessing indefinitely
                        until you press the camera icon again to make it stop.
                    </p>

                    <p>
                        If you set the threshold value to a number between from 0.01 to 1.0,
                        the AI will stop scanning when it reaches threshold value or level of
                        "sureness" for a particular prediction.

                    </p>

                    <p>
                        When AI/ML models try to classify
                        images they produce probability scores (of how "sure" the AI is about its prediction for the
                        image).
                        When one of the predicted classes reaches a threshold score, the model will stop
                        predicting and use this to make a google image search.
                        You can try setting this initially to 0.9 (or 90%) but you experiment
                        with other values. </p> </br>


                    <p>You also don't have to wait for the model to reach a specific score for it to stop.
                        You can chose to manualy click or touch the camera button to make the AI model stop scanning.
                        The predicted
                        class with the most recent highest score will then be used to make a google image search.
                    </p>

                    <a href="#form_modelSelectorLink"> <img style="height:5rem" src="./img/camera_icon.jpg"
                            alt="click on me to take you to the form box"> </a>

                    <p> When you've decided what URL to use for the new model and the thershold value you want to use
                        (or
                        just keep the default value of "any"), you can press enter or click the submit button.
                    </p>

                    <a href="#form_modelSelectorLink"> <img src="./img/submit_btn.jpg"
                            alt="click on me to take you to the form box"> </a>

                    <p>This will updated the model used
                        as well as the classes that the AI model will try to predict. It is highly advised that you only
                        use links or
                        URL's to models trained personally by you or AI/ML models from people you trust. Under no
                        circumstance will this web app
                        ask for personal or private information in order to run.</p>
                </div>

                <div class="card__action">
                    <p>
                        <a id="card_basicInfo_link" href="https://www.youtube.com/channel/UCHfixhX7E5ewBKB4kDMBvfQ">Take
                            me to More videos for RadLens-AI</a>
                    </p>
                </div>
            </div>





            <div class="card card--wide">
                <div class="card__title">
                    <h1>Find out more on RadHorizon</h1>
                </div>

                <div class="card__body">
                    <!--TODO: put this back in later -->
                    <!-- <iframe class="card__frames" src="https://radhorizon.com/rhz.com/" title="RadHorizon"></iframe> -->
                </div>

                <div class="card__action">
                    <p>
                        <a href="https://radhorizon.com/rhz.com/">Take me there.</a>
                    </p>
                </div>
            </div>
        </div>


        <div class="contact-section">
            <p>These are all just tools at your disposal.</p>
            <p>In the final analysis...</p>
            <p>You are the RadEdje</p>
        </div>
    </div>

    <div id="gfab" class="gfab">
        <i id="gfab__icon" class="fas fa-camera fa-2x"></i>
    </div>

    <a href=""></a>

    <footer>

        <script type="text/javascript" src="./index.js"></script>

    </footer>

</body>

</html>